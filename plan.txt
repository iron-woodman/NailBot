План: Telegram-бот "Запись к мастеру ногтевого сервиса" (SQLite + Google Calendar ссылки)
1. Инфраструктура и базовая настройка проекта
•	Создать структуру каталогов проекта (main.py, config.py, handlers/, database/, miniapp/, utils/)
•	Настроить файл .env с переменными окружения (BOT_TOKEN, ADMIN_ID, DATABASE_URL, TIMEZONE, GOOGLE_CALENDAR_URL)
•	Создать requirements.txt с зависимостями (aiogram, SQLAlchemy, aiosqlite, APScheduler, FastAPI, python-dotenv, pytz)
•	Настроить config.py для загрузки конфигурации из .env
•	Создать базовый main.py с инициализацией бота и планировщика
2. Модели базы данных (SQLAlchemy + SQLite)
•	Создать database/session.py с настройкой async-подключения к SQLite через aiosqlite
•	Реализовать модель User (id, telegram_id, username, full_name, created_at)
•	Реализовать модель Service (id, name, duration_minutes, price, description, active)
•	Реализовать модель Appointment (id, user_id, service_id, start_time, end_time, status, google_event_id, created_at)
•	Реализовать модель WorkSchedule (id, weekday, start_time, end_time, is_working)
•	Реализовать модель Holiday (id, date, reason)
•	Реализовать модель Settings (id, admin_id, planning_horizon_days, timezone)
•	Создать скрипт инициализации БД с начальными данными
3. Обработчики команд бота для клиентов
•	Реализовать обработчик команды /start с регистрацией пользователя в БД
•	Создать главное меню с inline-кнопками (Записаться, Мои записи, Отменить запись, Контакты)
•	Реализовать handlers/start.py с логикой приветствия на русском
•	Создать handlers/menu.py для управления главным меню
•	Реализовать обработчик callback-кнопок главного меню
4. Процесс записи на приём (Выбор услуги)
•	Создать handlers/booking.py для процесса записи
•	Реализовать функцию загрузки активных услуг из БД
•	Создать обработчик для отображения списка услуг с названием, длительностью и ценой
•	Реализовать callback-обработчик выбора услуги с валидацией
•	Добавить сохранение выбранной услуги в контекст пользователя
5. Процесс записи на приём (Выбор даты)
•	Реализовать функцию расчета доступных дат (с учетом горизонта планирования)
•	Создать функцию проверки рабочих дней по таблице work_schedule
•	Реализовать функцию исключения выходных дней из списка (таблица holidays)
•	Создать обработчик отображения календаря с доступными датами
•	Реализовать callback-обработчик выбора даты с сохранением в контекст
6. Процесс записи на приём (Выбор времени)
•	Реализовать функцию расчета свободных слотов на выбранный день
•	Создать функцию проверки пересечений с существующими записями в БД
•	Реализовать функцию расчета времени окончания на основе длительности услуги
•	Создать обработчик отображения доступного времени с интервалами 30 мин
•	Реализовать callback-обработчик выбора времени
7. Процесс записи на приём (Подтверждение и Google Calendar)
•	Реализовать функцию подтверждения записи и сохранения в БД с UTC
•	Создать функцию генерации ссылки для добавления в Google Calendar (с параметрами события)
•	Реализовать функцию форматирования деталей записи для вывода пользователю
•	Создать функцию отправки подтверждения клиенту с ссылкой на Google Calendar
•	Реализовать функцию отправки уведомления мастеру о новой записи
8. Управление записями клиентов
•	Создать handlers/appointments.py для просмотра и управления записями
•	Реализовать функцию отображения всех активных записей пользователя в хронологическом порядке
•	Создать обработчик для отмены записи с подтверждением
•	Реализовать функцию освобождения слота при отмене (обновление БД)
•	Добавить функцию уведомления мастера об отмене записи
9. Контакты и справочная информация
•	Создать handlers/contacts.py для отображения контактной информации мастера
•	Реализовать обработчик вывода контактов (Telegram, Instagram, телефон, адрес)
•	Создать handlers/info.py для справочной информации о боте
•	Реализовать handlers/error_handler.py для обработки ошибок пользователей
•	Добавить utils/messages.py с текстовыми шаблонами на русском
10. Утилиты для работы с интерфейсом
•	Создать utils/keyboards.py для создания inline и reply кнопок
•	Реализовать функции построения календаря (выбор даты)
•	Создать функции построения меню времени
•	Добавить функции для создания подтверждающих кнопок
•	Реализовать функции для создания навигационных кнопок
11. Система напоминаний (APScheduler - Инициализация)
•	Создать utils/scheduler.py с настройкой APScheduler
•	Реализовать функцию инициализации планировщика при старте бота
•	Создать функцию регистрации всех напоминаний при старте
•	Реализовать graceful shutdown планировщика при остановке бота
•	Добавить логирование работы планировщика
12. Система напоминаний (Отправка напоминаний)
•	Реализовать функцию поиска предстоящих записей в БД
•	Создать функцию расчета времени отправки напоминаний с GMT+3
•	Реализовать функцию отправки напоминания за 1 день до визита
•	Реализовать функцию отправки напоминания за 2 часа до визита
•	Добавить отслеживание отправленных напоминаний (флаг в БД или в памяти)
13. Бизнес-логика и работа со временем
•	Создать utils/time_utils.py для работы с UTC и timezone-aware datetime
•	Реализовать функцию конвертации времени между UTC и GMT+3
•	Создать функцию валидации дат и времени записи
•	Реализовать функцию проверки пересечений записей
•	Добавить функцию расчета рабочего времени мастера по дням недели
14. Backend для MiniApp (FastAPI - Инициализация)
•	Создать miniapp/app.py с настройкой FastAPI
•	Реализовать middleware для авторизации по Telegram ID
•	Создать функцию верификации подписи от Telegram WebApp Init Data
•	Реализовать обработчик ошибок (500, 403, 404)
•	Добавить CORS настройки и логирование
15. API endpoints для просмотра (GET)
•	Создать GET /api/schedule для просмотра расписания (месячный календарь со слотами)
•	Реализовать GET /api/appointments для просмотра всех записей
•	Создать GET /api/services для списка активных услуг
•	Реализовать GET /api/settings для текущих настроек (горизонт, timezone)
•	Добавить GET /api/holidays для просмотра выходных дней
16. API endpoints для управления услугами (CRUD)
•	Создать POST /api/services для добавления новой услуги
•	Реализовать PUT /api/services/:id для редактирования услуги
•	Создать DELETE /api/services/:id для удаления услуги
•	Добавить валидацию: название, длительность, цена
•	Реализовать фильтрацию по статусу активности
17. API endpoints для управления расписанием
•	Создать PUT /api/work-schedule/:weekday для изменения рабочих часов дня недели
•	Реализовать PUT /api/settings для обновления горизонта планирования и timezone
•	Создать POST /api/holidays для добавления выходного дня
•	Реализовать DELETE /api/holidays/:id для удаления выходного дня
•	Добавить валидацию дат и времени
18. API endpoints для управления записями
•	Создать DELETE /api/appointments/:id для отмены записи
•	Реализовать PUT /api/appointments/:id для изменения статуса записи
•	Добавить функцию автоматического обновления статуса на "completed" после визита
•	Реализовать уведомление клиента об отмене записи админом
•	Добавить логирование всех изменений записей
19. Frontend для MiniApp (Основа - Part 1)
•	Создать miniapp/templates/index.html с базовой HTML структурой
•	Реализовать навигацию между страницами (Расписание, Услуги, Записи, Выходные, Настройки)
•	Создать miniapp/static/style.css с основными стилями (мобильная версия)
•	Добавить miniapp/static/script.js для инициализации Telegram WebApp API
•	Реализовать функции для отправки запросов к API
20. Frontend для MiniApp (Расписание)
•	Реализовать страницу с календарем месячного вида
•	Создать визуализацию свободных и занятых слотов по дням
•	Добавить кликабельность по датам для детального просмотра
•	Реализовать отображение рабочих и выходных дней разными цветами
•	Добавить навигацию по месяцам
21. Frontend для MiniApp (Управление услугами)
•	Создать форму добавления новой услуги (название, длительность, цена, описание)
•	Реализовать таблицу со списком услуг с возможностью редактирования
•	Добавить inline-редактирование данных услуги
•	Реализовать удаление услуги с подтверждением
•	Добавить toggle для включения/отключения услуги
22. Frontend для MiniApp (Расписание рабочих дней)
•	Создать форму редактирования рабочих часов для каждого дня недели
•	Реализовать toggle для включения/отключения дня как рабочего
•	Добавить поля для времени начала и окончания работы
•	Реализовать сохранение изменений с валидацией
•	Добавить уведомление об успешном сохранении
23. Frontend для MiniApp (Выходные дни)
•	Создать форму добавления выходного дня (дата, причина)
•	Реализовать таблицу со списком всех выходных дней
•	Добавить возможность удаления выходного дня
•	Реализовать фильтрацию по датам
•	Добавить inline-редактирование причины выходного
24. Frontend для MiniApp (Записи и Настройки)
•	Создать страницу просмотра всех записей с фильтрацией (по дате, статусу)
•	Реализовать отмену записи по кнопке с подтверждением
•	Добавить страницу настроек (горизонт планирования в днях, timezone)
•	Реализовать форму редактирования этих параметров
•	Добавить отображение информации о боте и версии
25. Интеграция компонентов бота
•	Подключить все handlers к main.py (start, booking, appointments, contacts, errors)
•	Реализовать middleware для обработки ошибок и логирования
•	Добавить централизованное управление контекстом пользователя (FSMContext)
•	Создать обработчик неожиданных сообщений
•	Протестировать весь процесс записи end-to-end
26. Тестирование основного функционала
•	Протестировать регистрацию пользователя через /start
•	Проверить весь процесс записи (услуга -> дата -> время -> подтверждение)
•	Протестировать ссылку Google Calendar (открывается ли корректно)
•	Проверить отмену записи и освобождение слотов
•	Протестировать уведомления мастеру и клиентам
27. Тестирование напоминаний
•	Протестировать отправку напоминания за 1 день (имитировать время)
•	Проверить отправку напоминания за 2 часа
•	Протестировать корректность времени в GMT+3
•	Проверить отсутствие дублей напоминаний
•	Протестировать напоминания для отмененных записей (не отправлять)
28. Тестирование административного функционала
•	Протестировать авторизацию админа в miniApp (проверка ADMIN_ID)
•	Проверить все CRUD-операции для услуг
•	Протестировать редактирование рабочего расписания
•	Проверить добавление/удаление выходных дней
•	Протестировать изменение горизонта планирования
29. Тестирование безопасности и корректности
•	Проверить, что обычный пользователь не может получить доступ к miniApp
•	Протестировать валидацию всех входных данных
•	Проверить корректность расчетов свободных слотов
•	Протестировать обработку ошибок и исключений
•	Проверить корректность работы напоминаний в разное время суток и дни
30. Deployment на VPS
•	Создать Dockerfile для контейнеризации приложения
•	Настроить volumes для хранения SQLite БД
•	Создать docker-compose.yml для локального тестирования
•	Создать systemd unit файл (nailbot.service) для автозапуска
•	Подготовить инструкции по развертыванию на VPS с использованием systemd
31. Финализация и документация
•	Создать README.md с инструкциями по установке и использованию
•	Подготовить примеры конфигурации .env с комментариями
•	Создать скрипты для автоматического создания таблиц в БД
•	Добавить комментарии в критичные части кода на русском
•	Протестировать всю систему на VPS в боевых условиях
________________________________________
Общий подход:
План состоит из 31 конкретной подзадачи, сгруппированной в 6 блоков:
•	Инфраструктура и БД (1-3): Настройка проекта и модели данных
•	Клиентская часть бота (4-12): Запись, управление записями, напоминания
•	Администраторская часть (13-24): Backend и Frontend для miniApp
•	Интеграция (25): Объединение всех компонентов
•	Тестирование (26-29): Проверка функционала, безопасности и корректности
•	Production (30-31): Deployment и документация
Использование только Google Calendar ссылок упрощает реализацию, а русский язык делает интерфейс единообразным. SQLite хранит все данные локально, что обеспечивает быстрое развертывание и легкую миграцию.

